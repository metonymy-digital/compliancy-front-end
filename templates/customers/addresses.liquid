<!-- /templates/customers/addressess.liquid -->
{% comment %}

Template note:
- There are instances of inline JS below. Best practices advise separating this
into an external JS file
- There are separate 'add new' and 'edit' address forms

{% endcomment %}

{% paginate customer.addresses by 5 %}

<div class="grid">

  <div class="grid__item one-quarter medium-down--one-whole">
    {% include 'account-nav' %}
  </div>
  <div class="grid__item three-quarters medium-down--one-whole">
    {% include 'account-new-address-form' %}
    <div class="account-content">
      <div class="title-row">
        <h1>Saved Addresses</h1>
        <p>
          <a href="#" class="link--brown" onclick="Shopify.CustomerAddress.toggleNewForm(); return false;">add new</a>
        </p>
        <div class="hr" style="background-image: url({{ 'separator-2.svg' | asset_url }});"></div>
      </div>
      {% comment %}
      List all customer addresses with a unique edit form.
      Also add pagination in case they have a large number of addresses
      {% endcomment %}
      {% for address in customer.addresses %}

      <h3>
        {{ address.first_name | capitalize }} {{ address.last_name | capitalize }}
        {% if address == customer.default_address %}({{ 'customer.addresses.default' | t }}){% endif %}
      </h3>

      <p class="link--actions">
        {{ 'customer.addresses.edit' | t | edit_customer_address_link: address.id }} /
        {{ 'customer.addresses.delete' | t | delete_customer_address_link: address.id }}
      </p>

      <div class="address-display">
        <p>{{ address.company }}</p>
        <p>{{ address.street }}</p>
        <p>{{ address.city | capitalize }}</p>
        {% if address.province_code %}
        <p>{{ address.province_code | upcase }}</p>
        {% endif %}
        <p>{{ address.zip | upcase }}</p>
        <p>{{ address.country }}</p>
        <p>{{ address.phone }}</p>
      </div>

      {% include 'account-edit-address-form' %}
      {% endfor %}

      {% if paginate.pages > 1 %}
      <hr>
      <div class="pagination">
        {{ paginate | default_pagination | replace: '&laquo; Previous', '&larr;' | replace: 'Next &raquo;', '&rarr;' }}
      </div>
      {% endif %}
    </div>
  </div>
</div>

<script>
// Initialize observers on address selectors
new Shopify.CountryProvinceSelector('AddressCountryNew', 'AddressProvinceNew', {
  hideElement: 'AddressProvinceContainerNew'
});

// Setup province selector on each customer address
{% paginate customer.addresses by 5 %}
{% for address in customer.addresses %}
new Shopify.CountryProvinceSelector('AddressCountry_{{ address.id }}', 'AddressProvince_{{ address.id }}', {
  hideElement: 'AddressProvinceContainer_{{ address.id }}'}
);
{% endfor %}
{% endpaginate %}

// Modified contents of customer_area.js (global asset)
Shopify.CustomerAddress = {
  toggleForm: function(id) {
    var editEl = document.getElementById('EditAddress_'+id);
    editEl.style.display = editEl.style.display == 'none' ? '' : 'none';
    return false;
  },

  toggleNewForm: function() {
    var el = document.getElementById('AddAddress');
    el.style.display = el.style.display == 'none' ? '' : 'none';
    return false;
  },

  destroy: function(id, confirm_msg) {
    if (confirm(confirm_msg || "Are you sure you wish to delete this address?")) {
      Shopify.postLink('/account/addresses/'+id, {'parameters': {'_method': 'delete'}});
    }
  }
}
</script>

{% endpaginate %}
